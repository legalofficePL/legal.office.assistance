<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prison Form</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0; }
.container { max-width:800px; margin:20px auto; background:#fff; padding:20px; border-radius:6px; }
.step { display:none; }
.step.active { display:block; }
label { display:block; margin-top:12px; font-weight:bold; }
input, textarea, select { width:100%; padding:8px; margin-top:4px; }
textarea { min-height:80px; }
button { padding:10px 16px; cursor:pointer; margin-top:15px; }
.box { border:1px solid #ccc; padding:12px; margin-top:15px; border-radius:4px; }
.progress { height:8px; background:#ddd; border-radius:4px; margin-bottom:20px; }
.progress-bar { height:8px; background:#4caf50; width:0%; border-radius:4px; }
.preview { white-space:pre-wrap; background:#f9f9f9; padding:12px; }
.top-actions { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
</style>
</head>

<body>
<div class="container">

<div class="top-actions">
  <button type="button" onclick="goHome()">⬅ Home</button>

  <select onchange="setLang(this.value)">
    <option value="en">EN</option>
    <option value="ua">UA</option>
    <option value="ru">RU</option>
    <option value="ro">RO / MD</option>
  </select>
</div>

<div class="progress">
  <div class="progress-bar" id="progressBar"></div>
</div>

<form id="form">

<!-- STEP 1 -->
<div class="step active">
  <h2 data-t="personal"></h2>
  <label data-t="firstName"></label>
  <input name="f1_first_name">

  <label data-t="lastName"></label>
  <input name="f2_last_name">

  <label data-t="address"></label>
  <textarea name="f3_address"></textarea>
</div>

<!-- STEP 2 -->
<div class="step">
  <h2 data-t="contact"></h2>
  <label data-t="phone"></label>
  <input name="f4_phone">

  <label>Email</label>
  <input type="email" name="f5_email">
</div>

<!-- STEP 3 -->
<div class="step">
  <h2 data-t="case"></h2>
  <label data-t="caseNo"></label>
  <input name="f6_case_no">

  <label data-t="judgmentDate"></label>
  <input type="date" name="f7_judgment_date">

  <label data-t="courtCity"></label>
  <input name="f8_court_city">
</div>

<!-- STEP 4 -->
<div class="step">
  <h2 data-t="language"></h2>
  <label data-t="languageUnderstood"></label>
  <input name="f9_language">

  <label data-t="regulations"></label>
  <select name="f10_regulations">
    <option value="yes" data-t="yes"></option>
    <option value="no" data-t="no"></option>
  </select>
</div>

<!-- STEP 5 -->
<div class="step">
  <h2 data-t="prisons"></h2>
  <p data-t="describeFirst"></p>

  <div id="prisons"></div>

  <button type="button" onclick="addFirstPrison()" data-t="addFirst"></button>
  <button type="button" onclick="addPrison()" id="addNextBtn" style="display:none" data-t="addNext"></button>
</div>

<!-- STEP 6 -->
<div class="step">
  <h2 data-t="preview"></h2>
  <div class="preview" id="preview"></div>

  <button type="button" onclick="sendEmail()" data-t="send"></button>
  <button type="button" onclick="downloadTXT()" data-t="download"></button>
</div>

<div style="margin-top:20px">
  <button type="button" onclick="prev()" data-t="back"></button>
  <button type="button" onclick="next()" data-t="next"></button>
</div>

</form>
</div>

<script>
let currentLang = "en";
let step = 0;
let prisonCount = 0;

const steps = document.querySelectorAll(".step");
const progressBar = document.getElementById("progressBar");

/* ===== TRANSLATIONS ===== */
const T = {
en:{
personal:"Personal data",firstName:"First name",lastName:"Last name",address:"Address",
contact:"Contact",phone:"Phone",
case:"Case details",caseNo:"Case reference number",judgmentDate:"Date of judgment",courtCity:"Court city",
language:"Language and regulations",languageUnderstood:"Language understood",regulations:"Have you received the regulations?",
yes:"YES",no:"NO",
prisons:"Prisons and cells",describeFirst:"Describe the first prison and the first cell.",
addFirst:"➕ Add first prison and cell",addNext:"➕ Add another prison",
prisonName:"Prison name",cellDesc:"Cell description",
preview:"Final preview",download:"Download TXT",send:"Send by email",
back:"Back",next:"Next"
},
ua:{
personal:"Особисті дані",firstName:"Імʼя",lastName:"Прізвище",address:"Адреса",
contact:"Контакт",phone:"Телефон",
case:"Дані справи",caseNo:"Номер справи",judgmentDate:"Дата вироку",courtCity:"Місто суду",
language:"Мова та регламент",languageUnderstood:"Зрозуміла мова",regulations:"Чи отримали ви регламент?",
yes:"ТАК",no:"НІ",
prisons:"Вʼязниці та камери",describeFirst:"Опишіть першу вʼязницю та першу камеру.",
addFirst:"➕ Додати першу вʼязницю",addNext:"➕ Додати наступну вʼязницю",
prisonName:"Назва вʼязниці",cellDesc:"Опис камери",
preview:"Перегляд",download:"Завантажити TXT",send:"Надіслати email",
back:"Назад",next:"Далі"
},
ru:{
personal:"Личные данные",firstName:"Имя",lastName:"Фамилия",address:"Адрес",
contact:"Контакты",phone:"Телефон",
case:"Данные дела",caseNo:"Номер дела",judgmentDate:"Дата приговора",courtCity:"Город суда",
language:"Язык и регламент",languageUnderstood:"Понятный язык",regulations:"Получили ли вы регламент?",
yes:"ДА",no:"НЕТ",
prisons:"Тюрьмы и камеры",describeFirst:"Опишите первую тюрьму и первую камеру.",
addFirst:"➕ Добавить первую тюрьму",addNext:"➕ Добавить следующую тюрьму",
prisonName:"Название тюрьмы",cellDesc:"Описание камеры",
preview:"Просмотр",download:"Скачать TXT",send:"Отправить email",
back:"Назад",next:"Далее"
},
ro:{
personal:"Date personale",firstName:"Prenume",lastName:"Nume",address:"Adresă",
contact:"Contact",phone:"Telefon",
case:"Datele cauzei",caseNo:"Număr dosar",judgmentDate:"Data sentinței",courtCity:"Orașul instanței",
language:"Limba și regulament",languageUnderstood:"Limba înțeleasă",regulations:"Ați primit regulamentul?",
yes:"DA",no:"NU",
prisons:"Închisori și celule",describeFirst:"Descrieți prima închisoare și prima celulă.",
addFirst:"➕ Adaugă prima închisoare",addNext:"➕ Adaugă altă închisoare",
prisonName:"Nume închisoare",cellDesc:"Descriere celulă",
preview:"Previzualizare",download:"Descarcă TXT",send:"Trimite email",
back:"Înapoi",next:"Înainte"
}
};

function setLang(l){
  currentLang = l;
  document.querySelectorAll("[data-t]").forEach(e=>{
    e.textContent = T[l][e.dataset.t];
  });
}
setLang("en");

/* ===== NAVIGATION ===== */
function showStep(){
  steps.forEach((s,i)=>s.classList.toggle("active", i===step));
  progressBar.style.width = ((step+1)/steps.length*100)+"%";
  if(step===steps.length-1) buildPreview();
}
function next(){ if(step<steps.length-1){ step++; showStep(); } }
function prev(){ if(step>0){ step--; showStep(); } }
showStep();

/* ===== PRISONS ===== */
function addFirstPrison(){
  addPrison();
  document.getElementById("addNextBtn").style.display="inline-block";
}

function addPrison(){
  prisonCount++;
  const d = document.createElement("div");
  d.className="box";
  d.innerHTML = `
    <label>${T[currentLang].prisonName}</label>
    <input name="p${prisonCount}_name">

    <label>${T[currentLang].cellDesc}</label>
    <textarea name="p${prisonCount}_cell1"></textarea>
  `;
  document.getElementById("prisons").appendChild(d);
}

/* ===== OUTPUT ===== */
function buildPreview(){
  const data = new FormData(document.getElementById("form"));
  let out = "";
  for(const [k,v] of data.entries()){
    out += `${k}=${v}\n`;
  }
  document.getElementById("preview").textContent = out;
}

function downloadTXT(){
  const blob = new Blob([document.getElementById("preview").textContent],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="form.txt";
  a.click();
}

function sendEmail(){
  const body = encodeURIComponent(document.getElementById("preview").textContent);
  window.location.href = `mailto:?subject=Completed form&body=${body}`;
}

function goHome(){
  window.location.href = "/";
}
</script>

</body>
</html>
